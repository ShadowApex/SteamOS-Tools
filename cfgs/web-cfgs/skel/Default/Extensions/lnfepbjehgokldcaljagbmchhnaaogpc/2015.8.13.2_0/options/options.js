/*! CKP - KeePass integration for Chromeâ„¢, Copyright 2015 Steven Campbell
*/
"use strict";var keepassSettings=angular.module("keepassSettings",["ngAnimate","ngRoute","ngSanitize","jsonFormatter"]);keepassSettings.config(["$routeProvider",function($routeProvider){$routeProvider.when("/startup",{templateUrl:chrome.extension.getURL("/options/partials/startup.html"),controller:"startupController"}).when("/storedData",{templateUrl:chrome.extension.getURL("/options/partials/storedData.html"),controller:"storedDataController"}).when("/keyFiles",{templateUrl:chrome.extension.getURL("/options/partials/manageKeyFiles.html"),controller:"manageKeyFilesController"}).when("/databases",{templateUrl:chrome.extension.getURL("/options/partials/choose-file-type.html"),controller:"fileTypeController"}).when("/choose-file",{templateUrl:chrome.extension.getURL("/options/partials/choose-file.html"),controller:"docsController"}).when("/drag-drop-file",{templateUrl:chrome.extension.getURL("/options/partials/drag-drop-file.html"),controller:"dragDropController"}).when("/sample-database",{templateUrl:chrome.extension.getURL("/options/partials/sample-database.html"),controller:"sampleDatabaseController"}).when("/dropbox",{templateUrl:chrome.extension.getURL("/options/partials/choose-dropbox-file.html"),controller:"chooseDropboxFileController"}).when("/advanced",{templateUrl:chrome.extension.getURL("/options/partials/advanced.html"),controller:"advancedController"}).otherwise({redirectTo:"/startup"})}]),keepassSettings.factory("passwordFileStoreRegistry",["googleDrivePasswordFileManager","dropboxFileManager","localChromePasswordFileManager","sampleDatabaseFileManager",function(googleDrivePasswordFileManager,dropboxFileManager,localChromePasswordFileManager,sampleDatabaseFileManager){return new PasswordFileStoreRegistry(googleDrivePasswordFileManager,dropboxFileManager,localChromePasswordFileManager,sampleDatabaseFileManager)}]),keepassSettings.factory("googleDrivePasswordFileManager",["$http","$timeout",function($http,$timeout){return new GoogleDrivePasswordFileManager($http,$timeout)}]),keepassSettings.factory("sampleDatabaseFileManager",["$http",function($http){return new SampleDatabaseFileManager($http)}]),keepassSettings.factory("dropboxFileManager",["$http","settings",function($http,settings){return new DropboxFileManager($http,settings)}]),keepassSettings.factory("localChromePasswordFileManager",[function(){return new LocalChromePasswordFileManager}]),keepassSettings.factory("settings",[function(){return new Settings}]),keepassSettings.factory("localStorage",["settings",function(settings){return new LocalStorage(settings)}]),keepassSettings.factory("keyFileParser",[function(){return new KeyFileParser}]),keepassSettings.factory("protectedMemory",[function(){return new ProtectedMemory}]),keepassSettings.factory("secureCacheMemory",["protectedMemory",function(protectedMemory){return new SecureCacheMemory(protectedMemory)}]),keepassSettings.factory("secureCacheDisk",["protectedMemory","secureCacheMemory","settings",function(protectedMemory,secureCacheMemory,settings){return new SecureCacheDisk(protectedMemory,secureCacheMemory,settings)}]),keepassSettings.controller("startupController",["$scope","settings",StartupController]),keepassSettings.controller("storedDataController",["$scope",StoredDataController]),keepassSettings.controller("manageKeyFilesController",["$scope","settings","keyFileParser",ManageKeyFilesController]),keepassSettings.controller("advancedController",["$scope","settings","secureCacheDisk",AdvancedController]),keepassSettings.controller("dragDropController",["$scope","localChromePasswordFileManager",DragDropController]),keepassSettings.controller("sampleDatabaseController",["$scope","sampleDatabaseFileManager",SampleDatabaseController]),keepassSettings.controller("fileTypeController",["$scope","$location","passwordFileStoreRegistry",FileTypeController]),keepassSettings.controller("docsController",["$scope","googleDrivePasswordFileManager",DocsController]),keepassSettings.controller("chooseDropboxFileController",["$scope","dropboxFileManager",ChooseDropboxFileController]),keepassSettings.directive("icon",function(){function link(scope,element,attrs){function renderSVG(){var icon=element.scope()[attrs.p];icon||(icon=attrs.p);var html='<svg class="icon '+icon+'"><use xlink:href="#'+icon+'"></use></svg>';element.replaceWith(html)}renderSVG()}return{link:link,restrict:"E"}}),keepassSettings.directive("fileChange",function(){return{restrict:"A",link:function(scope,element,attrs){var onChangeFunc=element.scope()[attrs.fileChange];element.bind("change",function(e){for(var f,files=e.target.files,loadedFiles=[],i=0;f=files[i];i++){var loadedFile=new Promise(function(resolve,reject){var reader=new FileReader;reader.onloadend=function(theFile){return function(e){resolve({data:e.target.result,file:theFile})}}(f),reader.onerror=reader.onabort=function(){return function(){reject(new Error("File upload failed"))}}(f),reader.readAsArrayBuffer(f)});loadedFiles.push(loadedFile)}onChangeFunc(loadedFiles)})}}});