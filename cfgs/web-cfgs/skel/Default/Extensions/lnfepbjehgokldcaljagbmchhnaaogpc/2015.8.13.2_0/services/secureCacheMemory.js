/*! CKP - KeePass integration for Chromeâ„¢, Copyright 2015 Steven Campbell
*/
"use strict";function SecureCacheMemory(protectedMemory){var messageReceived,notifyReady,exports={},awaiting=[],ready=new Promise(function(resolve){notifyReady=resolve});exports.ready=function(){return ready.then(function(){return!0})};new Promise(function(resolve){messageReceived=resolve});return chrome.tabs.query({active:!0,currentWindow:!0},function(tabs){if(tabs&&tabs.length){var port=chrome.runtime.connect({name:"tab"+tabs[0].id});notifyReady(port)}}),ready.then(function(port){port.onMessage.addListener(function(serializedSavedState){var savedState=protectedMemory.hydrate(serializedSavedState),notifier=awaiting.shift();notifier(savedState)})}),exports.get=function(key){ready.then(function(port){port.postMessage({action:"get",key:key})});var p=new Promise(function(resolve){awaiting.push(resolve)});return p},exports.clear=function(){return ready.then(function(port){port.postMessage({action:"clear"})})},exports.save=function(key,value){return ready.then(function(port){var serializedValue=protectedMemory.serialize(value);port.postMessage({action:"save",key:key,value:serializedValue})})},exports}