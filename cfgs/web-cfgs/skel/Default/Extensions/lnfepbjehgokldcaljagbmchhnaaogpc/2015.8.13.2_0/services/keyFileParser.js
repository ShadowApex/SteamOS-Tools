/*! CKP - KeePass integration for Chromeâ„¢, Copyright 2015 Steven Campbell
*/
"use strict";function KeyFileParser(){function hex2arr(hex){try{for(var arr=[],i=0;i<hex.length;i+=2)arr.push(parseInt(hex.substr(i,2),16));return arr}catch(err){return[]}}var exports={};return exports.getKeyFromFile=function(keyFileBytes){var arr=new Uint8Array(keyFileBytes);if(0==arr.byteLength)return Promise.reject(new Error("key file has zero bytes"));if(32==arr.byteLength)return Promise.resolve(arr);if(64==arr.byteLength){var decoder=new TextDecoder,hexString=decoder.decode(arr),newArr=hex2arr(hexString);if(32==newArr.length)return Promise.resolve(newArr)}try{var decoder=new TextDecoder,xml=decoder.decode(arr),parser=new DOMParser,doc=parser.parseFromString(xml,"text/xml"),keyNode=doc.evaluate("//KeyFile/Key/Data",doc,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null);if(keyNode.singleNodeValue&&keyNode.singleNodeValue.textContent)return Promise.resolve(Base64.decode(keyNode.singleNodeValue.textContent))}catch(err){}var SHA={name:"SHA-256"};return window.crypto.subtle.digest(SHA,arr)},exports}