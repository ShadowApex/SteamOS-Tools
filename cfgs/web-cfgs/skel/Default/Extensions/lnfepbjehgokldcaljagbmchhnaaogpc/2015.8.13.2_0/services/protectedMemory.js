/*! CKP - KeePass integration for Chrome™, Copyright 2015 Steven Campbell
*/
"use strict";function ProtectedMemory(){function initNewKey(){return window.crypto.subtle.generateKey({name:"AES-CBC",length:256},!1,["encrypt","decrypt"]).then(function(k){enckey=k})}function getData(key){var encData=dataMap[key];return void 0===encData||"string"!=typeof encData?Promise.resolve(void 0):keyPromise.then(function(){var encBytes=Base64.decode(encData);return window.crypto.subtle.decrypt(AES,enckey,encBytes)}).then(function(data){var decoder=new TextDecoder,decoded=decoder.decode(new Uint8Array(data)),parsed=JSON.parse(decoded);return dePrepData(parsed)})}function setData(key,data){var preppedData=prepData(data),encoder=new TextEncoder,dataBytes=encoder.encode(JSON.stringify(preppedData));return keyPromise.then(function(){return window.crypto.subtle.encrypt(AES,enckey,dataBytes)}).then(function(encData){var dataString=Base64.encode(encData);return dataMap[key]=dataString,Promise.resolve()})}function clearData(){return dataMap={},keyPromise=initNewKey()}function serialize(data){var preppedData=prepData(data),encoder=new TextEncoder,dataBytes=encoder.encode(JSON.stringify(preppedData));return Base64.encode(dataBytes)}function deserialize(serializedData){if(void 0===serializedData||"string"!=typeof serializedData)return void 0;var dataBytes=Base64.decode(serializedData),decoder=new TextDecoder,decoded=decoder.decode(new Uint8Array(dataBytes)),parsed=JSON.parse(decoded);return dePrepData(parsed)}function prepData(data){if(null===data||void 0===data||"object"!=typeof data)return data;if(data.constructor==ArrayBuffer||data.constructor==Uint8Array)return randomString+Base64.encode(data);if(data.constructor==Array){for(var newArray=new Array(data.length),i=0;i<data.length;i++)newArray[i]=prepData(data[i]);return newArray}var newObject={};for(var prop in data)newObject[prop]=prepData(data[prop]);return newObject}function dePrepData(data){if(null===data||void 0===data||"object"!=typeof data&&"string"!=typeof data)return data;if("string"==typeof data)return 0==data.indexOf(randomString)?(data=data.slice(randomString.length),new Uint8Array(Base64.decode(data))):data;if(data.constructor==Array)for(var i=0;i<data.length;i++)data[i]=dePrepData(data[i]);else for(var prop in data)data[prop]=dePrepData(data[prop]);return data}var enckey,keyPromise,my={getData:getData,setData:setData,clearData:clearData,serialize:serialize,deserialize:deserialize,hydrate:deserialize},dataMap={},AES={name:"AES-CBC",iv:window.crypto.getRandomValues(new Uint8Array(16))};keyPromise=initNewKey();var randomString="Ựៅ";return my}